language: cpp

os:
- linux
- osx

compiler:
- clang
- gcc

env:
  matrix:
  - NODE_NVM_VERSION="0.10"
  global:
  - LD_LIBRARY_PATH: "/usr/local/lib"
  - secure: jkwZnKr5dcM9MQ6mOytnp6FHkbydSfa1L8d4jFp4v4K6Ee/iQh1YIq9c/J1zC0WLyuGokVGaijkKr6CW4nGZ5H8ygBtPo09imnRyH8X0bO5mEjl+KhbpdFqkXVLerpnAGMO7D6+6BtWJlK5uTDWhpeS7YayB3YfETVkllf4n6F8=
  - secure: ZBiq+KPVM72MF0rtvpui5l7curGXckz4Pefc1L04U6dd/MPa22StvCgXBG7DKhLwI5OgHE1da769asQ3rub/pDOonxAi7fHo3+r/ocbSBZeeaj+p5i5wavppOzD27gCLrpOnSQBk0DfoD+xOM8ZCfIttBbOBMRZ1dpWFG98bJ4c=

before_install:
- ./scripts/install_nvm.sh
- cd ./vendor/mapbox-gl-native && source ./scripts/local_mason.sh && cd ../../
- source ./vendor/mapbox-gl-native/scripts/travis_helper.sh
- source ./vendor/mapbox-gl-native/scripts/flags.sh
- TMP_DIR=`mktemp -d -t XXXXXXXXXXX`
- export PATH="${TMP_DIR}/bin":${PATH}
- MBGL_PREFIX=${TMP_DIR} source ./scripts/install_mbgl.sh

install:
- npm install --build-from-source --clang

before_script:
# Set the core file limit to unlimited so a core file is generated upon crash
- ulimit -c unlimited -S

script:
- npm test

after_success:
- ./scripts/travis_publish.sh

git:
  submodules: true
