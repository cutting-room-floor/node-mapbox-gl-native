language: cpp
os:
- linux
- osx
compiler:
- clang
- gcc
env:
  matrix:
  - NODE_NVM_VERSION="0.10"
  global:
  - AWS_S3_BUCKET: 'node-mapbox-gl-native'
  - secure: "BbLjMTgKGqbxrvHXvahGtt7NJVrCA2TiSGzgg1DdR3JVse5SUkG4FScKRwQWsWSMHUYQP4rCxEkaEB8FHlaXFVZ6hzHKIEPI7gKlcrH+WCZW0MibGO7L5/XhfFvFRhd5iXB5WjzjrEUzppShb1xxQWIRdhVZW0pMZpsJd48hynI="
  - secure: "cTYRVy66OUf9jYtgxIvRIlXwpykb59TK8s/ZKP21HgD+ARGbAPQ1YI8ozcDx6vB8FvspXAWz5pO9zbZWXPUEu2/dTZm+oYfrg0tGOXqEDjmc+GVfAHzKbQ2i9yD8wMqzfmwcD9GjOYXsddWuZAXOwUtTZUmG4T60gTheOZ4aqUA="
  - LD_LIBRARY_PATH: '/usr/local/lib'
before_install:
- export platform=$(uname -s | sed "y/ABCDEFGHIJKLMNOPQRSTUVWXYZ/abcdefghijklmnopqrstuvwxyz/")
- export TRAVIS_OS_NAME=${platform}
- if [[ "$platform" == "linux" ]]; then export CXX=g++-4.8; export CC=gcc-4.8; fi
- ./scripts/nvm_install.sh
- source ./vendor/mapbox-gl-native/scripts/travis_helper.sh
- source ./vendor/mapbox-gl-native/scripts/flags.sh
- (git clone https://github.com/mapbox/mason.git ~/.mason ; sudo ln -s ~/.mason/mason /usr/local/bin/mason)
- ./scripts/build_mbgl.sh
install:
- npm install --build-from-source --clang
- if [[ "$platform" == "linux" ]]; then glxinfo; fi
script:
- npm test
after_success:
- ./scripts/travis_publish.sh
git:
  submodules: true
